<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>DQ Â· Global Column Operations (Bronze/Silver/Gold)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- FEMSA favicon -->
  <link rel="icon" type="image/png" href="./images/femsa-logo.png" />
  <link rel="shortcut icon" type="image/png" href="./images/femsa-logo.png" />

  <style>
    :root{
      --brand:#E51C2D; --brand-2:#B11216;
      --ink:#111213; --muted:#6b7280;
      --bg:#fff7f7; --card:#ffffff; --line:#f0d5d6;
      --btn-bg:#E51C2D; --btn-bg-hover:#cf1826; --btn-text:#fff;
      --ring:0 0 0 3px rgba(229,28,45,.22);
      --shadow:0 6px 18px rgba(0,0,0,.06);
      --soft:#fff0f1;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:var(--bg)}
    .hero{background:linear-gradient(135deg,var(--brand) 0%,var(--brand-2) 70%);color:#fff;padding:18px 16px}
    .hero h1{margin:0;font-size:18px;font-weight:800;letter-spacing:.2px}
    main{max-width:980px;margin:22px auto;padding:0 16px}

    fieldset{margin:16px 0;border:1px solid var(--line);border-radius:16px;background:var(--card);padding:16px;box-shadow:var(--shadow)}
    legend{font-weight:800;color:var(--brand);letter-spacing:.2px}
    label{display:block;margin:6px 0 10px;font-weight:600}
    .hint{display:block;margin-top:4px;color:var(--muted);font-size:12px}

    /* Inputs */
    .ctrl{width:100%;height:44px;padding:0 12px;border:1px solid var(--line);border-radius:12px;background:transparent;color:var(--ink);outline:none;transition:border-color .15s ease, box-shadow .15s ease, background .15s ease}
    .ctrl:focus{border-color:var(--brand);box-shadow:var(--ring);background:var(--soft)}

    /* Grid row */
    .grid{display:grid;gap:12px}
    .row{
      display:grid;
      align-items:center;
      grid-template-columns: 1.2fr repeat(3,1fr) 56px;
      gap:12px;
      padding:6px 8px;
      border-radius:12px;
    }
    .row:hover{background:#fff9f9}

    @media (max-width:860px){
      .row{grid-template-columns:1fr}
    }

    /* Buttons */
    .actions{display:flex;gap:12px;flex-wrap:wrap;padding:12px 0}
    .btn{
      height:44px;padding:0 16px;border-radius:999px;border:1px solid transparent;background:var(--btn-bg);color:var(--btn-text);
      cursor:pointer;font-weight:700;letter-spacing:.2px;box-shadow:0 4px 14px rgba(177,18,22,.25);
      transition:background .2s ease, transform .06s ease, filter .15s ease;
    }
    .btn:hover{background:var(--btn-bg-hover);filter:saturate(1.05)}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:transparent;color:var(--brand);border-color:var(--brand)}

    textarea.mono{font-family:ui-monospace,Menlo,Consolas,monospace;width:100%;border:1px solid var(--line);border-radius:12px;padding:12px}
    .hidden{display:none}

    /* Centered, pretty trash button */
    .trash-wrap{
      display:grid;
      place-items:center;
      height:100%;
    }
    .trash{
      width:44px;height:44px;
      display:inline-grid;place-items:center;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      box-shadow:0 8px 20px rgba(0,0,0,.08);
      cursor:pointer;
      transition:transform .08s ease, background .18s ease, border-color .18s ease, box-shadow .18s ease, filter .15s ease;
    }
    .trash:hover{
      background:#ffe6e9;
      border-color:#f3b7bc;
      box-shadow:0 10px 24px rgba(229,28,45,.18);
      filter:saturate(1.1);
    }
    .trash:active{ transform: translateY(1px) scale(.98) }
    .trash:focus-visible{ outline:none; box-shadow:var(--ring) }
    .trash svg{ width:20px; height:20px; fill:var(--brand); }
    .sr-only{position:absolute;width:1px;height:1px;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;padding:0}
  </style>
</head>
<body>
  <header class="hero"><h1>Global Column Operations (Bronze/Silver/Gold)</h1></header>

  <main>
    <form id="ops-form" class="grid" autocomplete="off">
      <fieldset>
        <legend>Tables</legend>
        <label>Bronze table
          <input id="bronze-path" class="ctrl" type="text" placeholder="dbw_bronze.ar.orders_bz" required />
          <span class="hint">Unity Catalog full path</span>
        </label>
        <label>Silver table
          <input id="silver-path" class="ctrl" type="text" placeholder="dbw_silver.ar.orders_sv" required />
        </label>
        <label>Gold table
          <input id="gold-path" class="ctrl" type="text" placeholder="dbw_gold.ar.orders_gd" required />
        </label>
      </fieldset>

      <fieldset>
        <legend>Columns & operations</legend>
        <div id="col-list" class="grid"></div>
        <div class="actions">
          <button type="button" class="btn secondary" id="add-col">+ Add column</button>
        </div>
      </fieldset>

      <div class="actions">
        <button type="button" id="preview-btn" class="btn secondary">Preview JSON</button>
        <button type="submit" class="btn">Download JSON</button>
      </div>

      <textarea id="preview" class="mono hidden" rows="16" readonly></textarea>
    </form>
  </main>

  <script>
    const colList = document.getElementById("col-list");

    function addColRow(values = {}) {
      const div = document.createElement("div");
      div.className = "row";
      div.innerHTML = `
        <div>
          <label>Column
            <input class="ctrl col" type="text" placeholder="total_amount" />
          </label>
        </div>
        <div>
          <label>Bronze
            <select class="ctrl op_bronze">
              <option value="">--</option>
              <option value="count">count</option>
              <option value="sum">sum</option>
            </select>
          </label>
        </div>
        <div>
          <label>Silver
            <select class="ctrl op_silver">
              <option value="">--</option>
              <option value="count">count</option>
              <option value="sum">sum</option>
            </select>
          </label>
        </div>
        <div>
          <label>Gold
            <select class="ctrl op_gold">
              <option value="">--</option>
              <option value="count">count</option>
              <option value="sum">sum</option>
            </select>
          </label>
        </div>
        <div class="trash-wrap">
          <button type="button" class="trash" title="Remove column" aria-label="Remove column">
            <span class="sr-only">Remove</span>
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M9 3h6v2h5v2H4V5h5V3zm1 6h2v8h-2V9zm4 0h2v8h-2V9zM6 7h12l-1.2 12.1A2 2 0 0 1 14.8 21H9.2a2 2 0 0 1-2-1.9L6 7z"/>
            </svg>
          </button>
        </div>
      `;
      colList.appendChild(div);

      div.querySelector(".trash").onclick = () => div.remove();

      if (values.col) div.querySelector(".col").value = values.col;
      if (values.op_bronze) div.querySelector(".op_bronze").value = values.op_bronze;
      if (values.op_silver) div.querySelector(".op_silver").value = values.op_silver;
      if (values.op_gold) div.querySelector(".op_gold").value = values.op_gold;
    }

    // First empty row
    addColRow();
    document.getElementById("add-col").onclick = () => addColRow();

    function buildPayload(){
      const bronze = document.getElementById("bronze-path").value.trim();
      const silver = document.getElementById("silver-path").value.trim();
      const gold   = document.getElementById("gold-path").value.trim();
      const cols = [];
      colList.querySelectorAll(".row").forEach(div=>{
        const col = div.querySelector(".col").value.trim();
        if(!col) return;
        cols.push({
          column: col,
          bronze: div.querySelector(".op_bronze").value || null,
          silver: div.querySelector(".op_silver").value || null,
          gold:   div.querySelector(".op_gold").value   || null
        });
      });
      return { tables:{ bronze, silver, gold }, columns: cols };
    }

    document.getElementById("preview-btn").onclick = () => {
      const ta = document.getElementById("preview");
      ta.classList.remove("hidden");
      ta.value = JSON.stringify(buildPayload(), null, 2);
      ta.scrollIntoView({behavior:"smooth"});
    };

    document.getElementById("ops-form").onsubmit = (e) => {
      e.preventDefault();
      const data = buildPayload();
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = Object.assign(document.createElement("a"), { href:url, download:"dq_global_ops.json" });
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>
